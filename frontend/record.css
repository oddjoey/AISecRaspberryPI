let model;

// Load the BlazeFace model
async function loadModel() {
  console.log("Loading model...");
  model = await blazeface.load(); // Load Face Detection model
  console.log("Model loaded.");
}

// Function to classify the uploaded image
async function classifyImage() {
  const img = document.getElementById("preview");
  
  if (!model) {
    document.getElementById("result").innerText = "Model is loading...";
    return;
  }

  // Convert image to Tensor
  const tensor = tf.browser.fromPixels(img)
    .resizeNearestNeighbor([128, 128]) // Resize to match model input size
    .toFloat()
    .expandDims(0); // Add batch dimension

  // Detect faces in the image
  const predictions = await model.estimateFaces(tensor, false);
  
  if (predictions.length > 0) {
    // Simulated result - Replace this with an actual gender model if available
    const gender = Math.random() > 0.5 ? "Male" : "Female";
    document.getElementById("result").innerText = `Prediction: ${gender}`;
  } else {
    document.getElementById("result").innerText = "No face detected.";
  }

  tensor.dispose(); // Free up memory
}

// Handle image upload and display preview
document.getElementById("fileInput").addEventListener("change", (event) => {
  const file = event.target.files[0];
  if (file) {
    const reader = new FileReader();
    reader.onload = (e) => {
      const img = document.getElementById("preview");
      img.src = e.target.result;
      img.style.display = "block";
    };
    reader.readAsDataURL(file);
  }
});

// Load the model when the page loads
loadModel();
